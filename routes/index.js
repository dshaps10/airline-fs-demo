var express = require('express');
var router = express.Router();

// Package declaration for Optimizely SDK
// and Optimizely logger
var optimizely = require('@optimizely/optimizely-sdk');
var defaultLogger = require('@optimizely/optimizely-sdk/lib/plugins/logger');
var LOG_LEVEL = require ('@optimizely/optimizely-sdk/lib/utils/enums').LOG_LEVEL;

var Analytics = require('analytics-node');
var analytics = new Analytics('rBTEIO3jiPJI0W4nPdPNp2wUgAC4a9Bq');

// For retrieving the remote datafile from Optimizely's CDN
var fetch = require('node-fetch');

// Bundled datafile
var datafile = require('../datafile.json');

// URL for fetching the datafile
var url = 'https://cdn.optimizely.com/datafiles/99yQq3pGweBtGY1Zvh7MBq.json'

// For grabbing the remote datafile
fetch(url) // Call the fetch function passing the url of the API as a parameter
		.then(function(res) {
			return res.json();
		})
		.then(function(data) {
			// Will reinitialize the client with a remote datafile
			// this is where the logger is initialized as well
			optimizelyClient = optimizely.createInstance({ 
				datafile: data,
				logger: defaultLogger.createLogger({ logLevel: LOG_LEVEL.INFO })
			});
		})
		.catch(function(err) {
	    	console.log(err);
		});

// Create an instance of Optimizely on the server
// Uses the default, bundled datafile
var optimizelyClient = optimizely.createInstance({ datafile: datafile });

// CONTROL whitelisted ID
var userId = "123";

// TREATMENT whitelisted ID
// var userId = "456";

/* GET home page. */
router.get('/', function(req, res, next) {

	// Buckets visitor into control or treatment for Destination Recs test
	var variation = optimizelyClient.activate('destination_recommendations', userId);

	analytics.identify({
		userId: userId
	});

	// Default recommended locations
	var northAmericanTravelDestinations = {
		destination1: {
			name: "San Francisco",
			img: "https://images.unsplash.com/photo-1526404423292-15db8c2334e5?ixlib=rb-0.3.5&ixid=eyJhcHBfaWQiOjEyMDd9&s=25a6176d2b7c949856700b8afd9bea32&auto=format&fit=crop&w=975&q=80"
		},
		destination2: {
			name: "New York",
			img: "data:image/jpeg;base64,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"
		},
		destination3: {
			name: "Vancouver",
			img: "https://images.unsplash.com/photo-1527201488222-1877fba009be?ixlib=rb-0.3.5&ixid=eyJhcHBfaWQiOjEyMDd9&s=975a1e9c1683fbe02d0d0fbbf1f6b5d1&auto=format&fit=crop&w=1350&q=80"
		}
	}

	// Alternative recommended locations
	var internationalTravelDestinations = {
		destination1: {
			name: "Sydney",
			img: "https://images.unsplash.com/photo-1524293581917-878a6d017c71?ixlib=rb-0.3.5&ixid=eyJhcHBfaWQiOjEyMDd9&s=6b7a43ba69b82c9d52d9bd09eff8a652&auto=format&fit=crop&w=1350&q=80"
		},
		destination2: {
			name: "Hong Kong",
			img: "https://images.unsplash.com/photo-1529583302858-7143cb9440cb?ixlib=rb-0.3.5&ixid=eyJhcHBfaWQiOjEyMDd9&s=94b1eb8f43be842e2149fa5d7c146bcc&auto=format&fit=crop&w=934&q=80"
		},
		destination3: {
			name: "Auckland",
			img: "https://images.unsplash.com/photo-1531274071216-aea6e7a086c7?ixlib=rb-0.3.5&ixid=eyJhcHBfaWQiOjEyMDd9&s=342f6a184021974c93bbcf5070694b62&auto=format&fit=crop&w=975&q=80"
		}
	}

	// Will determine whether to show default or alternative recs based on output from
	// alternativeRecs feature variable
	if (variation === 'CONTROL') {
		res.render('index', { travelDestinations: internationalTravelDestinations });
	} else if (variation === 'TREATMENT') {
		res.render('index', { travelDestinations: northAmericanTravelDestinations });
	} else {
		res.render('index', { travelDestinations: internationalTravelDestinations });
	}

});

router.get('/flight-deals/north-america', function(req, res, next) {
	optimizelyClient.track('Viewed North American Deals Page', userId);

	res.render('NorthAmericaLandingPage');
});

router.get('/checkout', function(req, res, next) {
	
	res.render('CheckoutForm');

});

router.get('/confirmation', function(req, res, next) {
	
	// optimizelyClient.track('Booked Flight', userId);
	
	analytics.track({
		userId: userId,
		event: 'Booked Flight'
	});

	res.render('Confirmation');
})


// router.post('/datafileUpdates', function(req, res, next) {
// 	console.log('received datafile update');
// })

module.exports = router;























